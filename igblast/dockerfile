FROM ubuntu:22.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    git \
    wget \
    libxml2 \
    zlib1g \
    && rm -rf /var/lib/apt/lists/*

# 1. Use wget to download igblast version 1.21.0
RUN wget "https://ftp.ncbi.nih.gov/blast/executables/igblast/release/1.21.0/ncbi-igblast-1.21.0-x64-linux.tar.gz" \
    -O /tmp/igblast.tar.gz

# 2. Create the directory for igblast
RUN mkdir -p /opt/igblast

# 3. Extract igblast to the created directory and strip the top directory
RUN tar -xzf /tmp/igblast.tar.gz -C /opt/igblast --strip-components=1

# 4. Remove the downloaded tar.gz file to save space
RUN rm /tmp/igblast.tar.gz

ENV IGDATA="/opt/igblast"
ENV PATH="/opt/igblast/bin:${PATH}"

# 5. Copy OGRDB database version 9 into the igblast database directory
RUN mkdir -p /opt/igblast/database
COPY OGRDB /opt/igblast/database

# Default command (Snakemake overrides this)
CMD ["bash"]